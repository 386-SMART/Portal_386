<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mis Contratos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      href="/img/favicon-16x16.ico"
      type="image/x-icon"
    />
    <style>
      :root {
        --if-primary: #0d6efd;
        --if-secondary: #6c757d;
        --if-success: #198754;
        --if-warning: #ffc107;
        --if-danger: #dc3545;
        --if-text-main: #212529;
        --if-text-muted: #6c757d;
        --if-bg-main: #f8f9fc;
        --if-bg-soft: #f1f5f9;
        --if-bg-panel: #ffffff;
        --if-border-color: #e2e8f0;
        --if-font-sans: "Inter", sans-serif;
      }

      body {
        font-family: var(--if-font-sans);
        background-color: var(--if-bg-main);
        color: var(--if-text-main);
        overflow: hidden; /* Mantenemos el layout de pantalla completa */
      }

      .main-container {
        display: flex;
        height: 100vh;
      }

      .contract-list-panel {
        width: 420px;
        flex-shrink: 0;
        border-right: 1px solid var(--if-border-color);
        display: flex;
        flex-direction: column;
        background-color: var(--if-bg-panel);
      }

      .contract-list-header {
        padding: 1.25rem;
        border-bottom: 1px solid var(--if-border-color);
      }

      .contract-list-body {
        overflow-y: auto;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .contract-card {
        border: 1px solid var(--if-border-color);
        border-radius: 0.75rem;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border-left: 5px solid transparent;
      }

      .contract-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
        border-color: var(--if-primary);
      }

      .contract-card.active {
        border-color: var(--if-primary);
        box-shadow: 0 4px 20px rgba(13, 110, 253, 0.15);
        background-color: #f4f8ff;
      }

      .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 0.5rem;
      }
      .status-dot.vigente {
        background-color: var(--if-success);
      }
      .status-dot.por-vencer {
        background-color: var(--if-warning);
      }
      .status-dot.vencido {
        background-color: var(--if-danger);
      }

      .detail-panel {
        flex-grow: 1;
        overflow-y: auto;
      }

      .detail-header {
        background-color: var(--if-bg-panel);
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--if-border-color);
      }

      .kpi-item {
        background-color: var(--if-bg-panel);
        padding: 1.5rem;
        border-radius: 0.75rem;
        border: 1px solid var(--if-border-color);
      }

      .chart-card {
        background-color: var(--if-bg-panel);
        padding: 1.5rem;
        border-radius: 0.75rem;
        border: 1px solid var(--if-border-color);
      }
      .chart-container {
        height: 300px;
      }

      .nav-tabs .nav-link {
        font-weight: 600;
        color: var(--if-text-muted);
      }
      .nav-tabs .nav-link.active {
        color: var(--if-primary);
      }


    /* Estilo para el logo en el header del detalle del contrato */
    .header-logo {
        max-height: 45px; /* Altura notable pero no excesiva */
        width: auto;
    }
    /* Para pantallas peque√±as, hacemos el logo un poco m√°s peque√±o */
    @media (max-width: 576px) {
        .header-logo {
            max-height: 35px;
        }
    }

    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="contract-list-panel">
        <div class="contract-list-header">
          <h4 class="mb-3 fw-bold">Mis Contratos</h4>
          <div class="row g-2">
            <div class="col-12">
              <input
                type="search"
                id="search-contrato"
                class="form-control"
                placeholder="Buscar por nombre..."
              />
            </div>
            <div class="col-12">
              <select id="filter-estado" class="form-select">
                <option value="">Todos los estados</option>
                <option value="Vigente">Vigente</option>
                <option value="Pr√≥ximo a Vencer">Pr√≥ximo a Vencer</option>
                <option value="Vencido">Vencido</option>
                <option value="Venta">Venta</option>
                <option value="Leasing">Leasing</option>
              </select>
            </div>
          </div>
        </div>
        <div class="contract-list-body">
          <% contratos.forEach(contrato => { %>
            
            <div class="contract-card" data-contrato-id="<%= contrato.id_contrato %>">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <span class="fw-bold"><%= contrato.nombre_contrato %></span>
    <span class="badge rounded-pill text-bg-<%= contrato.estado.color %>">
      <%= contrato.estado.texto %>
    </span>
  </div>

  <!-- üßæ Tipo de contrato -->
  <% if (contrato.tipo_contrato) { %>
    <div class="small text-muted mb-1">
      <i class="bi bi-file-earmark-text me-1"></i> <%= contrato.tipo_contrato %>
    </div>
  <% } %>

  <!-- üìÖ Fechas -->
  <div class="text-muted small mb-2">
    <i class="bi bi-calendar-check me-1"></i>
    <%= new Date(contrato.fecha_inicio).toLocaleDateString() %> -
    <%= contrato.fecha_fin ? new Date(contrato.fecha_fin).toLocaleDateString() : 'Indefinido' %>
  </div>

  <!-- üîó Link a contrato relacionado -->
  <% if (contrato.id_relacion) { %>
    <a href="#" 
       class="small text-primary mt-2 d-inline-block link-relacion" 
       data-relacion="<%= contrato.id_relacion %>">
      <i class="bi bi-link-45deg"></i> Ver contrato relacionado
    </a>
  <% } %>

  <!-- üíΩ Equipos -->
  <div class="d-flex justify-content-between align-items-center small pt-2 border-top">
    <span class="text-muted">
      <i class="bi bi-hdd-stack me-1"></i> <%= contrato.total_equipos %> Equipos
    </span>
    <i class="bi bi-chevron-right text-muted"></i>
  </div>
</div>



          <% }) %>
        </div>
      </div>

      <div class="detail-panel" id="dashboard-container">
        <div class="d-flex h-100 align-items-center justify-content-center">
          <div class="text-center text-muted">
            <i class="bi bi-arrow-left-circle" style="font-size: 3rem"></i>
            <h3 class="mt-3 fw-light">Selecciona un Contrato</h3>
            <p>Haz clic en un contrato de la lista para ver sus detalles.</p>
          </div>
        </div>
      </div>
    </div>

    <div
      class="offcanvas offcanvas-end"
      tabindex="-1"
      id="equipo-details-offcanvas"
    >
      <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title fw-bold" id="offcanvas-title"></h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
        ></button>
      </div>
      <div class="offcanvas-body" id="offcanvas-body"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@2"></script>
    <script src="/js/clients/contratos.js"></script>
  </body>
</html>
