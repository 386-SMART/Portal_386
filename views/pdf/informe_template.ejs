<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Constancia de Visita Técnica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; font-size: 11px; color: #000; margin: 20px; }
        .container { width: 100%; max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 10px; }
        .header .title { text-align: center; font-size: 14px; font-weight: bold; flex: 1; }
        .logo-left { order: 2; margin-left: auto; }
        .logo-right { order: 0; margin-right: auto; }
        .cv-number { font-weight: bold; text-align: right; border: 1px solid #000; padding: 2px 6px; display: inline-block; float: right; margin-top: 5px; background-color: #e9ecef; }
        .section-title { background-color: #e9ecef; font-weight: bold; padding: 6px; border: 1px solid #000; border-bottom: none; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        th, td { border: 1px solid #000; padding: 4px 6px; vertical-align: top; word-break: break-word; }
        .label { font-weight: bold; }
        .photo-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 20px; page-break-inside: avoid; }
        .photo-grid img { width: 100%; border: 1px solid #ccc; }
        .firma-contenedor {
          display: flex;
          justify-content: space-between;
          align-items: flex-end;
          height: 100px;
          padding: 10px 30px;
        }
        .firma-box {
          text-align: center;
          width: 45%;
        }
        .firma-box img {
          max-height: 60px;
          margin-bottom: 4px;
        }
        .firma-label {
          border-top: 1px solid #000;
          font-size: 10px;
          margin-top: 2px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <img src="<%= logo386Base64 %>" height="45" class="logo-right">
        <div class="title">CONSTANCIA DE VISITA TÉCNICA</div>
        <img src="<%= clienteLogoBase64 %>" height="45" class="logo-left">
    </div>
    <div class="cv-number">CVT - <%= String(informe.id_informe).padStart(4, '0') %></div>

    <div class="section-title">DATOS DEL CLIENTE</div>
    <table>
        <tr>
            <td><span class="label">Cliente:</span> <%= informe.empresa_nombre || '' %></td>
            <td><span class="label">Contrato:</span> <%= informe.nombre_contrato || '' %></td>
        </tr>
        <tr>
            <td><span class="label">Usuario:</span> <%= informe.usuario_cliente_manual || '' %></td>
            <td><span class="label">Dirección:</span> <%= informe.direccion_manual || '' %></td>
        </tr>
        <tr>
            <td colspan="2"><span class="label">Sede:</span> <%= informe.sede_manual || '' %></td>
        </tr>
    </table>

    <div class="section-title">INFORMACIÓN DEL EQUIPO</div>
    <table>
        <tr>
            <td><span class="label">Modelo:</span> <%= informe.modelo || '' %></td>
            <td><span class="label">Product Number:</span> <%= informe.part_number || '' %></td>
        </tr>
        <tr>
            <td><span class="label">Serie:</span> <%= informe.num_serie || '' %></td>
            <td><span class="label">Nombre del Equipo:</span> <%= informe.nombre_equipo_manual || '' %></td>
        </tr>
    </table>

    <div class="section-title">DIAGNÓSTICO - REPARACIÓN</div>
    <table>
        <tr>
            <td><span class="label">Ticket:</span> <%= informe.Codigo_Aranda || 'N/A' %></td>
            <td><span class="label">Número de Pedido:</span> <%= informe.Numero_Pedido || 'N/A' %></td>
            <td><span class="label">Fecha de servicio:</span> <%= new Date(informe.fecha_servicio).toLocaleDateString() %></td>
        </tr>
        <tr><td colspan="3"><span class="label">Incidente Reportado:</span><br><%= informe.incidente_reportado || '' %></td></tr>
        <tr><td colspan="3"><span class="label">Revisión Inicial:</span><br><%= informe.revision_inicial || '' %></td></tr>
        <tr><td colspan="3"><span class="label">Acciones Realizadas:</span><br><%= informe.acciones_realizadas || '' %></td></tr>
        <tr><td colspan="3"><span class="label">Estado del Equipo:</span><br><%= informe.estado_equipo || '' %></td></tr>
        <tr><td colspan="3"><span class="label">Observaciones:</span><br><%= informe.observaciones || '' %></td></tr>
    </table>

    <div class="section-title">CONFORMIDAD</div>
    <table>
        <tr>
            <td><span class="label">Hora de inicio:</span> <%= informe.hora_inicio %></td>
            <td><span class="label">Hora de finalización:</span> <%= informe.hora_finalizacion %></td>
        </tr>
    </table>
    <div class="firma-contenedor">
        <div class="firma-box">
            <% if (informe.firma_usuario) { %><img src="<%= informe.firma_usuario %>"><% } %>
            <div class="firma-label">Firma del Usuario</div>
        </div>
        <div class="firma-box">
            <% if (informe.firma_tecnico) { %><img src="<%= informe.firma_tecnico %>"><% } %>
            <div class="firma-label">Firma del Técnico</div>
        </div>
    </div>
    <table>
        <tr>
            <td rowspan="2" style="width: 50%; vertical-align: middle;">
                <span class="label">Usuario:</span> <%= informe.firmante_type === 'Client_Ti' ? informe.cti_nombre : informe.uf_nombre %><br>
                <span class="label">Teléfono:</span> <%= informe.firmante_type === 'Client_Ti' ? informe.cti_cel : informe.uf_cel %><br>
                <span class="label">Correo:</span> <%= informe.firmante_type === 'Client_Ti' ? informe.cti_correo : informe.uf_correo %>
            </td>
            <td style="vertical-align: middle;"><span class="label">Especialista 386 SMART:</span><br><%= informe.tecnico_nombre %> <%= informe.tecnico_apellido %></td>
        </tr>
    </table>

    <% if (fotos && fotos.length > 0) { %>
        <div style="page-break-before: always;">
            <h5 class="fw-bold text-center my-3">FOTOS ADJUNTAS</h5>
            <div class="photo-grid">
                <% fotos.forEach(foto => { %>
                    <img src="<%= foto.base64 %>">
                <% }); %>
            </div>
        </div>
    <% } %>
</div>
</body>
</html>
